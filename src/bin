#!/usr/bin/env node
const fs = require('fs');
const chalk = require('chalk');
const gitlabCiValidate = require('../src/index');

function showHelp() {
  console.log(`
  Usage
    $ gitlab-ci-validate <file-path>
  Help
    $ gitlab-ci-validate -h --help
  `);
  process.exit(0);
}

const cmd = process.argv[2];

if (cmd === '-h' || cmd === '--help') {
  showHelp();
}

if (!fs.existsSync(cmd)) {
  console.log(chalk.red(`
  ERROR: ${cmd} does not exists!`));
  showHelp();
}

gitlabCiValidate(cmd).then((data) => {
  if (data.status === 'valid') {
    console.log(chalk.green(`${cmd} is valid`));
  } else {
    console.log(chalk.red(`${cmd} is invalid:`));
    data.errors.forEach((err) => {
      console.log(chalk.red(`- ${err}`));
    });
  }
}).catch((err) => {
  console.error(chalk.red(err));
});
